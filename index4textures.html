<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>confluent vs powergraph</title>   

	<script src="lib/three.min.js"></script>
	<script src="lib/d3.js"></script>
	<script src="lib/networkcube.js"></script>
	<script src="lib/jquery.js"></script>
    <script src="lib/d3-legend.js"></script>
	<script src="lib/cola.min.js"></script> 
    <script src="lib/topojson.v1.min.js"></script> 
	<script src="class/confluent.js"></script>
    <style>
        div{
            float: left;
            margin-right: 5px;
        }
        
    </style>


</head>
<body>
	<div id="visFrame"></div>
    <div id="visFrame1"></div>
    <div id="visFrame2"></div>
    <div id="visFrame3"></div>
    <svg id="legend"></svg>
    
	<script>
    var color_scale = d3.scale.linear()
                     .domain([0,1])
                     .range([0,0.5])
    
    var my_projection = d3.geo.mercator()
                    .scale(900);

    var size_scale = d3.scale.linear()
                     .domain([0, 20])
                     .range([20, 60])

    var frequence_scale = d3.scale.linear()
                     .domain([0, 10])
                     .range([0,14])



    
        networkcube.loadJson("data/TKM_data0.json", function(dataset){
        networkcube.importData("miserables", dataset);
        var graph = networkcube.getDynamicGraph(dataset.name, "miserables");
        var nodes = graph.nodes().toArray();
        var links = graph.links().toArray();
        var my_app = new Main("#visFrame",nodes , links, 500,500);

        var confluentGraph = my_app.confluentGraph;
        var nodes = confluentGraph.nodes;
        var links = confluentGraph.links;

        confluentGraph.launch_network(1000,function(){
            for (var i = 0;i<links.length; i++){
                
                links[i].size[0] = 40
                confluentGraph.set_tube_color(i, "0x3498db", 1);
                confluentGraph.set_tube_width(i, 0.1);
                confluentGraph.set_links_color(i,  1);

                var color = {r:255,g:0,b:0};
                var number_litterature = parseFloat(links[i].attr('number_publication') + links[i].attr('number_patent'));
                var percentage_patent = links[i].attr('number_patent') / number_litterature;
                var percentage_publis = links[i].attr('number_publication') / number_litterature;
                
                var color_custom = new THREE.Color().setHSL(0.45,1,color_scale(percentage_patent));

                links[i].gate_colors[0] = color_custom;
                links[i].size[0] = size_scale(number_litterature);

                //var frequence = parseFloat(links[i].attr('frequence'))

                confluentGraph.fit_temporal_distribution(i);

            }
            for (var i = 0;i<nodes.length; i++){
                if (nodes[i].attr('type') == 1){
                    confluentGraph.updateNode_color(i , new THREE.Color("rgb(213, 62, 79)"), 15 )
                }
                if (nodes[i].attr('type') == 2){
                    confluentGraph.updateNode_color(i , new THREE.Color("rgb(255, 255, 191)"), 15 )
                }
                
            }


        })
    }); 
        networkcube.loadJson("data/TKM_data1.json", function(dataset){
        networkcube.importData("miserables", dataset);
        var graph = networkcube.getDynamicGraph(dataset.name, "miserables");
        var my_app = new Main("#visFrame1",graph,  500,500);

        var confluentGraph = my_app.confluentGraph;
        var nodes = confluentGraph.nodes;
        var links = confluentGraph.links;

        confluentGraph.launch_network(1000,function(){
            for (var i = 0;i<links.length; i++){
                
                links[i].size[0] = 40
                confluentGraph.set_tube_color(i, "0x3498db", 1);
                confluentGraph.set_tube_width(i, 0.1);
                confluentGraph.set_links_color(i,  1);

                var color = {r:255,g:0,b:0};
                var number_litterature = parseFloat(links[i].attr('number_publication') + links[i].attr('number_patent'));
                var percentage_patent = links[i].attr('number_patent') / number_litterature;
                var percentage_publis = links[i].attr('number_publication') / number_litterature;
                
                var color_custom = new THREE.Color().setHSL(0.45,1,color_scale(percentage_patent));

                links[i].gate_colors[0] = color_custom;
                links[i].size[0] = size_scale(number_litterature);

                //var frequence = parseFloat(links[i].attr('frequence'))

                confluentGraph.fit_temporal_distribution(i);

            }
            for (var i = 0;i<nodes.length; i++){
                if (nodes[i].attr('type') == 1){
                    confluentGraph.updateNode_color(i , new THREE.Color("rgb(213, 62, 79)"), 15 )
                }
                if (nodes[i].attr('type') == 2){
                    confluentGraph.updateNode_color(i , new THREE.Color("rgb(255, 255, 191)"), 15 )
                }
                
            }


        })
    }); 
        networkcube.loadJson("data/TKM_data2.json", function(dataset){
        networkcube.importData("miserables", dataset);
        var graph = networkcube.getDynamicGraph(dataset.name, "miserables");
        var my_app = new Main("#visFrame2",graph, 500,500);

        var confluentGraph = my_app.confluentGraph;
        var nodes = confluentGraph.nodes;
        var links = confluentGraph.links;

        confluentGraph.launch_network(1000,function(){
            for (var i = 0;i<links.length; i++){
                
                links[i].size[0] = 40
                confluentGraph.set_tube_color(i, "0x3498db", 1);
                confluentGraph.set_tube_width(i, 0.1);
                confluentGraph.set_links_color(i,  1);

                var color = {r:255,g:0,b:0};
                var number_litterature = parseFloat(links[i].attr('number_publication') + links[i].attr('number_patent'));
                var percentage_patent = links[i].attr('number_patent') / number_litterature;
                var percentage_publis = links[i].attr('number_publication') / number_litterature;
                
                var color_custom = new THREE.Color().setHSL(0.45,1,color_scale(percentage_patent));

                links[i].gate_colors[0] = color_custom;
                links[i].size[0] = size_scale(number_litterature);

                //var frequence = parseFloat(links[i].attr('frequence'))

                confluentGraph.fit_temporal_distribution(i);

            }
            for (var i = 0;i<nodes.length; i++){
                if (nodes[i].attr('type') == 1){
                    confluentGraph.updateNode_color(i , new THREE.Color("rgb(213, 62, 79)"), 15 )
                }
                if (nodes[i].attr('type') == 2){
                    confluentGraph.updateNode_color(i , new THREE.Color("rgb(255, 255, 191)"), 15 )
                }
                
            }


        })
    }); 
        networkcube.loadJson("data/TKM_data3.json", function(dataset){
        networkcube.importData("miserables", dataset);
        var graph = networkcube.getDynamicGraph(dataset.name, "miserables");
        var my_app = new Main("#visFrame3",graph, 500,500);

        var confluentGraph = my_app.confluentGraph;
        var nodes = confluentGraph.nodes;
        var links = confluentGraph.links;

        confluentGraph.launch_network(1000,function(){
            for (var i = 0;i<links.length; i++){
                
                links[i].size[0] = 40
                confluentGraph.set_tube_color(i, "0x3498db", 1);
                confluentGraph.set_tube_width(i, 0.1);
                confluentGraph.set_links_color(i,  1);

                var color = {r:255,g:0,b:0};
                var number_litterature = parseFloat(links[i].attr('number_publication') + links[i].attr('number_patent'));
                var percentage_patent = links[i].attr('number_patent') / number_litterature;
                var percentage_publis = links[i].attr('number_publication') / number_litterature;
                
                var color_custom = new THREE.Color().setHSL(0.45,1,color_scale(percentage_patent));

                links[i].gate_colors[0] = color_custom;
                links[i].size[0] = size_scale(number_litterature);

                //var frequence = parseFloat(links[i].attr('frequence'))

                confluentGraph.fit_temporal_distribution(i);

            }
            for (var i = 0;i<nodes.length; i++){
                if (nodes[i].attr('type') == 1){
                    confluentGraph.updateNode_color(i , new THREE.Color("rgb(213, 62, 79)"), 15 )
                }
                if (nodes[i].attr('type') == 2){
                    confluentGraph.updateNode_color(i , new THREE.Color("rgb(255, 255, 191)"), 15 )
                }
                
            }


        })
    }); 

    // var legendRectSize = 18;
    // var legendSpacing = 4;
    // var scale = size_scale;


    // var legend = d3.select("#legend").selectAll('.legend')
    //   .data(scale.domain())
    //   .enter()
    //   .append('g')
    //   .attr('class', 'legend')
    //   .attr('transform', function(d, i) {
    //     var height = legendRectSize + legendSpacing;
    //     var offset =  height * scale.domain().length / 2;
    //     var horz = -2 * legendRectSize;
    //     var vert = i * height - offset;
    //     return 'translate(' + 0 + ',' + ((legendRectSize+ legendSpacing) * i)  + ')';
    //   });

    // legend.append('rect')
    //   .attr('width', legendRectSize)
    //   .attr('height', legendRectSize)
    //   .style('fill', "blue")
    //   .style('stroke', scale)

    // legend.append('text')
    //   .attr('x', legendRectSize + legendSpacing)
    //   .attr('y', legendRectSize - legendSpacing)
    //   .text(function(d) { return d });


	
	</script>


</body>
</html>