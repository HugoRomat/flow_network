<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>ParticleVis.js</title>

      <script src="https://threejs.org/build/three.min.js"></script>
      <script src="https://d3js.org/d3.v3.min.js"></script>
      <script src="https://cdn.rawgit.com/tgdwyer/WebCola/master/WebCola/cola.min.js"></script>
      <script src="https://d3js.org/topojson.v1.min.js"></script>
      <script src="Sparkiz.js"></script>
    <style>
    body{
      margin:0;
    }

        canvas {
          position: absolute;
          top: 0;
          left: 0;
        }
        .land {
          fill: #abdda4;
          stroke: black;
        }

        .county-boundary {
          fill: none;
          stroke: none;
          stroke-width: .5px;
        }

        .state-boundary {
          fill: none;
          stroke: black;
        }

    </style>


</head>
<body>

  <div id="visFrame"></div>

  <script>
  var color_scale = d3.scale.linear()
                   .domain([0,400])
                   .range([d3.rgb("#ff0000"), d3.rgb('#fffe00')])
   var size_scale = d3.scale.linear()
                    .domain([0,1500])
                    .range([10, 25])

  var proj = d3.geo.albersUsa()
                   .scale(1000)
                   .translate([0,0]);

  var projection = d3.geo.albersUsa()
                     .scale(1000)
                     .translate([400, 250]);

  var path = d3.geo.path()
      .projection(projection);

var svg = d3.select("#visFrame").append("svg")
    .attr("width", 800)
    .attr("height", 500)
    .attr("position", "absolute")
    .attr("top", "0")
    .attr("left", "0");

  d3.json("us.json", function(error, us) {
    if (error) throw error;

    svg.insert("path", ".graticule")
        .datum(topojson.feature(us, us.objects.land))
        .attr("class", "land")
        .attr("d", path);

    svg.insert("path", ".graticule")
        .datum(topojson.mesh(us, us.objects.counties, function(a, b) { return a !== b && !(a.id / 1000 ^ b.id / 1000); }))
        .attr("class", "county-boundary")
        .attr("d", path);

    svg.insert("path", ".graticule")
        .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
        .attr("class", "state-boundary")
        .attr("d", path);
});




 d3.json("data.json", function(json) {


   var app = Sparkiz.force("#visFrame", 800,500,"#abd9e9", 0)
       .nodes(json.nodes)
       .links(json.links)

       .create()

       .links_mapping("color", "#3288bd")
       .links_mapping("size", 2)

       .nodes_mapping("color", "#fee08b")
       .nodes_mapping("label", function(d, i) {return d.city; })
       .nodes_mapping("size",  5)
       .nodes_mapping("x", function(d, i) {return proj([d.long,d.lat])[0]; })
       .nodes_mapping("y", function(d, i) {return - proj([d.long,d.lat])[1];  })

       .particle_mapping("color", "#d53e4f")
       .particle_mapping("size",function(d, i) {return size_scale(d.passengers); })
       .particle_mapping("texture", "rectangle.png")

       .start(1000);


      });



  </script>


</body>
</html>
